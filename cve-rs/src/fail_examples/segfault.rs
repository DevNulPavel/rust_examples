//! Segmentation fault в 100% безопасном rust.
//!
//!
//! Для начала мы используем беззвучную дыру (а так же нашу реализацию transmute)
//! для создание мутабельной null ссылки на `u8`.
//!
//! Затем мы выполняем dereference на этом значении и ловим segmentation fault.

////////////////////////////////////////////////////////////////////////////////////////

use crate::helpers::{not_alloc, null_mut};

////////////////////////////////////////////////////////////////////////////////////////

/// Пример segfault в программе.
///
/// Смотрите на [`crate::transmute()`].
pub(crate) fn segfault() -> ! {
    // Создаем ссылку c null вида `&mut u8`.
    let null = null_mut::<u8>();
    *null = 42;

    // Если запись в null не работает, тогда попробуем
    // значение записать какое-то значение в максимумальное значение адреса.
    let max = not_alloc::<u8>();
    *max = 69;

    // Повезло, не падает
    unreachable!("Sorry, your platform is too strong.")
}
